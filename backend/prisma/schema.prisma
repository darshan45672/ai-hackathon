// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  PARTICIPANT
  ADMIN
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  password   String?  // Optional for OAuth users
  name       String
  firstName  String?
  lastName   String?
  avatar     String?
  role       UserRole @default(PARTICIPANT)
  provider   String?  // 'google', 'github', 'email', etc.
  providerId String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  applications Application[]
  reviews      Review[]

  @@map("users")
}

model Application {
  id              String            @id @default(cuid())
  title           String
  description     String
  problemStatement String
  solution        String
  techStack       String[]
  teamSize        Int
  teamMembers     String[]
  githubRepo      String?
  demoUrl         String?
  status          ApplicationStatus @default(DRAFT)
  submittedAt     DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  // Relations
  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviews  Review[]

  @@map("applications")
}

model Review {
  id         String   @id @default(cuid())
  score      Int      // 1-10 rating
  feedback   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  reviewerId    String
  reviewer      User        @relation(fields: [reviewerId], references: [id], onDelete: Cascade)

  @@unique([applicationId, reviewerId])
  @@map("reviews")
}
